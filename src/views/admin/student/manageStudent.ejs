<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/css/roomPrac.css" />
        <title>Document</title>
    </head>
    <body>
        <div class="room-container">
            <div class="room-header">
                <h2>Quản lí sinh viên</h2>
            </div>
            <div class="room-body">
                <div class="add-room">
                    <button class="add-room-btn" id="myBtn">Thêm mới sinh viên</button>
                </div>
                <div class="room-list">
                    <table id="customers">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Tên sinh viên</th>
                                <th>Email</th>
                                <th>MSSV</th>
                                <th>Lớp</th>
                                <th>Giới tính</th>
                                <th>Các thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% for (let i=0; i< data.length; i++) { %>

                            <tr>
                                <td><%= i + 1 %></td>
                                <td><%=data[i].name %></td>
                                <td><%=data[i].email %></td>
                                <td><%=data[i].mssv %></td>
                                <td><%=data[i].className %></td>
                                <td><%=data[i].keyName %></td>

                                <td style="display: flex; gap: 15px">
                                    <form action="/edit-student/<%= data[i].id %>" method="GET">
                                        <button class="room-action edit editBtn" type="submit">Edit</button>
                                    </form>
                                    <form action="/delete-student/<%= data[i].id %>" method="POST">
                                        <button class="room-action delete" type="submit">Delete</button>
                                    </form>
                                </td>
                            </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-container">
            <div id="myModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div class="create-room">
                        <form class="modal__form" action="/create-new-student" method="POST">
                            <div class="modal__item-wrap">
                                <span class="modal__manager-name"> Tạo mới sinh viên </span>
                            </div>
                            <div class="modal__content-wrap">
                                <div class="modal__item-wrap">
                                    <label class="modal__item-label">Tên sinh viên</label>
                                    <input class="modal__item-input" valid="tên sinh viên" type="text" name="name" />
                                </div>
                                <div class="modal__item-wrap">
                                    <label class="modal__item-label">Email</label>
                                    <input class="modal__item-input" valid="email" type="email" name="email" />
                                </div>
                                <div class="modal__item-wrap">
                                    <label class="modal__item-label">Mật khẩu</label>
                                    <input class="modal__item-input" valid="mật khẩu" type="password" name="password" />
                                </div>
                                <div class="modal__item-wrap">
                                    <label class="modal__item-label">Lớp</label>
                                    <input class="modal__item-input" valid="lớp" type="text" name="className" />
                                </div>
                                <div class="modal__item-wrap">
                                    <label class="modal__item-label">MSSV</label>
                                    <input class="modal__item-input" valid="mã số sinh viên" type="text" name="mssv" />
                                </div>
                                <div class="modal__item-wrap gender-option">
                                    <label class="modal__item-label">Giới tính: </label>

                                    <div class="option-item">
                                        <input class="input_gender" type="radio" name="gender" value="M" />
                                        <label>Nam</label>
                                    </div>
                                    <div class="option-item">
                                        <input class="input_gender" type="radio" name="gender" value="F" />
                                        <label>Nữ</label>
                                    </div>
                                    <div class="option-item">
                                        <input class="input_gender" type="radio" name="gender" value="O" />
                                        <label>Khác</label>
                                    </div>

                                    <!-- <input class="modal__item-input" valid="giới tính" type="text" name="gender" /> -->
                                </div>

                                <div class="modal__item-wrap">
                                    <button class="modal__item-button" type="submit">Lưu</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Get the modal
            let modal = document.getElementById('myModal');

            // Get the button that opens the modal
            let btn = document.getElementById('myBtn');

            // Get the <span> element that closes the modal
            let span = document.getElementsByClassName('close')[0];

            // When the user clicks the button, open the modal
            btn.onclick = function () {
                modal.style.display = 'block';
            };

            // When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = 'none';
            };

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            };

            //Validate input
            let btnSave = document.querySelector('.modal__item-button');
            let inputs = document.querySelectorAll('.modal__item-input');
            let inputsGender = document.querySelectorAll('.input_gender');

            btnSave.onclick = (e) => {
                let isValid = true;
                for (let i = 0; i < inputs.length; i++) {
                    if (!inputs[i].value) {
                        let valueError = inputs[i].getAttribute('valid');
                        alert(`Vui lòng nhập ${valueError}`);
                        isValid = false;
                        break;
                    } else if (inputs[i].name === 'email') {
                        let regexEmail = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

                        let checkEmail = regexEmail.test(inputs[i].value);

                        if (!checkEmail) {
                            alert('Email không đúng định dạng, vui lòng nhập lại!');
                            isValid = false;
                            break;
                        }
                    } else if (inputs[i].name === 'password') {
                        if (inputs[i].value.length < 6) {
                            alert('Mật khẩu phải dài hơn 6 ký tự, vui lòng nhập lại!');
                            isValid = false;
                            break;
                        }
                    }
                }

                let isGenderCheck = false;
                if (isValid) {
                    for (let i = 0; i < inputsGender.length; i++) {
                        if (inputsGender[i].checked) {
                            isGenderCheck = true;
                        }
                    }

                    if (!isGenderCheck) {
                        alert('Vui lòng nhập giới tính của sinh viên');
                        isValid = false;
                    }
                }

                if (!isValid) {
                    e.preventDefault();
                }
            };
        </script>
    </body>
</html>
